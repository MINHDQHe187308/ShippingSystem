@* ~/Views/Front/Order/OrderList.cshtml *@
@using System
@model IEnumerable<ASP.Models.Front.Order>
@{
    ViewData["Title"] = "Order List";
    Layout = "../Shared/Layout/Front/_Layout";
}
<div class="container-fluid px-4">
    <!-- Header Section -->
    <div class="text-center mb-5 pt-3">
        <h1 class="fw-bold text-primary mb-2 display-4 animate-slide-in-down">
            <i class="bi bi-receipt-cutoff me-2 animate-bounce-slow"></i>Order Management
        </h1>
    </div>
    <!-- Filters Section -->
    <div class="d-flex justify-content-end mb-4">
        <div class="card shadow-lg border-0 animate-slide-in-right" style="width: 450px; border-radius: 20px; overflow: hidden;">
            <div class="card-header bg-gradient-primary text-white border-0" style="background: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%); border-radius: 20px 20px 0 0 !important;">
                <h6 class="fw-bold mb-0 d-flex align-items-center">
                    <i class="bi bi-funnel me-2 animate-spin-slow"></i>Advanced Filters
                </h6>
            </div>
            <div class="card-body p-4 bg-light">
                <form method="get">
                    <div class="row g-3">
                        <div class="col-6">
                            <label class="form-label fw-semibold small text-dark mb-2">Day of Week</label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-white border-primary"><i class="bi bi-calendar3-week text-primary animate-pulse-slow"></i></span>
                                <select name="dayOfWeek" class="form-select form-select-sm border-primary animate-fade-in" onchange="this.form.submit()" style="border-radius: 0 8px 8px 0; transition: all 0.3s ease;">
                                    <option value="">All Days</option>
                                    @foreach (DayOfWeek d in Enum.GetValues<DayOfWeek>())
                                    {
                                        <option value="@d" selected="@(ViewBag.DayOfWeek?.ToString() == d.ToString() ? "selected" : null)">@d</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <label class="form-label fw-semibold small text-dark mb-2">Customer Code</label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-white border-primary"><i class="bi bi-person-lines-fill text-primary animate-pulse-slow"></i></span>
                                <select name="customerCode" class="form-select form-select-sm border-primary animate-fade-in" onchange="this.form.submit()" style="border-radius: 0 8px 8px 0; transition: all 0.3s ease;">
                                    <option value="">All Customers</option>
                                    @if (ViewBag.CustomerCodes != null)
                                    {
                                        @foreach (var code in ViewBag.CustomerCodes)
                                        {
                                            <option value="@code" selected="@(ViewBag.CustomerCode?.ToString() == code ? "selected" : null)">@code</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    @{
        var grouped = Model.GroupBy(o => o.ShipDate.Date).OrderBy(g => g.Key);
    }
    @if (!grouped.Any())
    {
        <div class="text-center py-5 animate-fade-in">
            <i class="bi bi-inbox display-1 text-muted mb-3 animate-rotate-slow"></i>
            <h4 class="text-muted">No orders found for the selected filters.</h4>
            <p class="text-muted">Try adjusting your filters to view available orders.</p>
        </div>
    }
    else
    {
        @foreach (var group in grouped)
        {
            <!-- Date Group Header -->
            <div class="card shadow-lg border-0 mb-4 overflow-hidden animate-slide-in-up" style="border-radius: 20px;">
                <div class="card-header bg-gradient-primary text-white p-4 border-0" style="background: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%);">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <span class="badge bg-light text-primary me-3 fs-5 px-3 py-2 rounded-pill animate-scale-in">
                                <i class="bi bi-calendar-day me-1 animate-bounce-slow"></i>@group.Key.ToString("dddd")
                            </span>
                            <span class="badge bg-light text-primary fs-5 px-3 py-2 rounded-pill animate-scale-in">
                                <i class="bi bi-receipt me-1 animate-bounce-slow"></i>@group.Count() Orders
                            </span>
                        </div>
                        <h3 class="fw-bold mb-0 animate-fade-in">@group.Key.ToString("MMMM dd, yyyy")</h3>
                    </div>
                </div>
                <!-- Orders Table - Removed table-responsive to eliminate horizontal scroll; table now fits width with flexible columns -->
                <div class="table-wrapper">
                    <table class="table table-hover mb-0 align-middle fit-width-table" id="ordersTable_@group.Key.ToString("yyyyMMdd")">
                        <thead class="table-dark" style="background: linear-gradient(135deg, #343a40 0%, #495057 100%);">
                            <tr>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-10"><i class="bi bi-person-badge me-1 animate-pulse-slow"></i>Customer Code</th>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-12">
                                    <span class="truck-box me-1" aria-hidden="true">
                                        <i class="bi bi-truck truck-led" aria-hidden="true"></i>
                                    </span>
                                    Ship Date
                                </th>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-10"><i class="bi bi-arrow-right-circle me-1 animate-pulse-slow"></i>Trans Code</th>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-8"><i class="bi bi-boxes me-1 animate-pulse-slow"></i>Total Pallet</th>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-8"><i class="bi bi-grid-3x3-gap me-1 animate-pulse-slow"></i>Total Column</th>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-8"><i class="bi bi-circle-fill me-1 animate-pulse-slow"></i>Status</th>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-10"><i class="bi bi-clock me-1 animate-pulse-slow"></i>Plan Delivery</th>
                                <th class="border-0 fw-semibold text-white ps-2 py-3 w-20"><i class="bi bi-clock-history me-1 animate-pulse-slow"></i>Actions</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            @foreach (var order in group.OrderBy(o => o.ShipDate))
                            {
                                <tr class="align-middle animate-slide-in-up">
                                    <td class="fw-medium text-primary ps-2 py-3 animate-fade-in-delay">@order.CustomerCode</td>
                                    <td class="text-primary ps-2 py-3 animate-fade-in-delay">@order.ShipDate.ToString("MMM dd, yyyy")</td>
                                    <td class="text-muted ps-2 py-3 animate-fade-in-delay">@order.TransCd</td>
                                    <td class="fw-semibold text-success ps-2 py-3 animate-fade-in-delay">@order.TotalPallet <i class="bi bi-check-circle-fill text-success animate-bounce-slow"></i></td>
                                    <td class="fw-semibold text-info ps-2 py-3 animate-fade-in-delay">@order.TotalColumn <i class="bi bi-info-circle text-info animate-rotate-slow"></i></td>
                                    <td class="ps-2 py-3 animate-fade-in-delay">
                                        @{
                                            var status = order.OrderStatus switch
                                            {
                                                0 => "Planned",
                                                1 => "Pending",
                                                2 => "Completed",
                                                3 => "Shipped",
                                                4 => "Delay",
                                                _ => "Unknown"
                                            };
                                            var badgeClass = order.OrderStatus switch
                                            {
                                                0 => "bg-dark text-white",
                                                1 => "bg-primary text-white",
                                                2 => "bg-success text-white",
                                                3 => "bg-warning text-dark",
                                                4 => "bg-danger text-white",
                                                _ => "bg-secondary text-white"
                                            };
                                            var iconClass = order.OrderStatus switch { 0 => "clock", 1 => "hourglass-split", 2 => "check-circle", 3 => "truck", 4 => "exclamation-triangle", _ => "question-circle" };
                                        }
                                        <span class="badge @badgeClass px-3 py-2 rounded-pill fs-6 animate-pulse-glow">
                                            <i class="bi bi-@iconClass me-1 animate-bounce-slow"></i>@status
                                        </span>
                                    </td>
                                    <td class="fw-medium text-warning ps-2 py-3 animate-fade-in-delay">@order.EndTime.ToString("HH:mm") <i class="bi bi-alarm text-warning animate-pulse-slow"></i></td>
                                    <td class="ps-2 py-3 animate-fade-in-delay">
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-sm btn-outline-info rounded-pill me-1 animate-hover-lift" onclick="loadDelayHistory('@order.UId')" title="View Delay History">
                                                <i class="bi bi-eye me-1 animate-spin-on-hover"></i>View History
                                            </button>
                                            <button class="btn btn-sm btn-outline-success rounded-pill animate-hover-lift" onclick="exportToExcel('@order.UId')" title="Export Picking List to Excel">
                                                <i class="bi bi-file-earmark-excel me-1 animate-spin-on-hover"></i>Export Excel
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
    }
    <!-- Delay History Modal -->
    <div class="modal fade" id="delayModal" tabindex="-1" aria-labelledby="delayModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content border-0 shadow-xl rounded-4 animate-slide-in-down" style="border-radius: 20px;">
                <div class="modal-header bg-gradient-primary text-white border-0 rounded-top-4" style="background: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%);">
                    <h5 class="modal-title fw-bold mb-0 d-flex align-items-center fs-3" id="delayModalLabel">
                        <i class="bi bi-clock-history me-2 animate-pulse-slow"></i>Delay History Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white animate-hover-scale" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4 bg-light">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover align-middle fit-width-table" id="delayTable" style="border-radius: 12px; overflow: hidden; font-size: 1.2rem;">
                            <thead class="table-dark" style="background: linear-gradient(135deg, #6c757d 0%, #495057 100%);">
                                <tr>
                                    <th class="fw-semibold ps-2 py-3 w-20"><i class="bi bi-exclamation-triangle me-1 text-warning animate-pulse-slow"></i>Delay Type</th>
                                    <th class="fw-semibold ps-2 py-3 w-30"><i class="bi bi-chat-text me-1 text-info animate-pulse-slow"></i>Reason</th>
                                    <th class="fw-semibold ps-2 py-3 w-25"><i class="bi bi-clock me-1 text-primary animate-pulse-slow"></i>Start Time</th>
                                    <th class="fw-semibold ps-2 py-3 w-25"><i class="bi bi-stopwatch me-1 text-danger animate-pulse-slow"></i>Delay (Hours)</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer bg-gradient-light border-0 rounded-bottom-4 justify-content-center" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                    <button type="button" class="btn btn-secondary px-4 rounded-pill fs-5 animate-hover-lift" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1 animate-spin-on-hover"></i>Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
@section Styles {
    <link href="~/css/OrderList.css" rel="stylesheet" />
}
@section Scripts {
    <script src="~/js/OrderList.js"></script>
}