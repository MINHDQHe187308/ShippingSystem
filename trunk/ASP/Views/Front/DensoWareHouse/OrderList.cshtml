@* ~/Views/Front/Order/OrderList.cshtml *@
@using System
@model IEnumerable<ASP.Models.Front.Order>
@{
    ViewData["Title"] = "Order List";
    Layout = "../Shared/Layout/Front/_Layout";
}
<div class="container-fluid px-4">
    <!-- Header Section -->
    <div class="text-center mb-5 pt-3">
        <h1 class="fw-bold text-primary mb-2">
            <i class="bi bi-receipt-cutoff me-2"></i>Order Management
        </h1>
    </div>
    <!-- Filters Section -->
    <div class="d-flex justify-content-end mb-4">
        <div class="card shadow-sm border-0" style="width: 450px; border-radius: 12px;">
            <div class="card-header bg-primary text-white border-0 rounded-top" style="border-radius: 12px 12px 0 0 !important;">
                <h6 class="fw-bold mb-0 d-flex align-items-center">
                    <i class="bi bi-funnel me-2"></i>Advanced Filters
                </h6>
            </div>
            <div class="card-body p-4">
                <form method="get">
                    <div class="row g-3">
                        <div class="col-6">
                            <label class="form-label fw-semibold small text-dark mb-2">Day of Week</label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-light border-primary"><i class="bi bi-calendar3-week text-primary"></i></span>
                                <select name="dayOfWeek" class="form-select form-select-sm border-primary" onchange="this.form.submit()" style="border-radius: 0 6px 6px 0;">
                                    <option value="">All Days</option>
                                    @foreach (DayOfWeek d in Enum.GetValues<DayOfWeek>())
                                    {
                                        <option value="@d" selected="@(ViewBag.DayOfWeek?.ToString() == d.ToString() ? "selected" : null)">@d</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-6">
                            <label class="form-label fw-semibold small text-dark mb-2">Customer Code</label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-light border-primary"><i class="bi bi-person-lines-fill text-primary"></i></span>
                                <select name="customerCode" class="form-select form-select-sm border-primary" onchange="this.form.submit()" style="border-radius: 0 6px 6px 0;">
                                    <option value="">All Customers</option>
                                    @if (ViewBag.CustomerCodes != null)
                                    {
                                        @foreach (var code in ViewBag.CustomerCodes)
                                        {
                                            <option value="@code" selected="@(ViewBag.CustomerCode?.ToString() == code ? "selected" : null)">@code</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    @{
        var grouped = Model.GroupBy(o => o.ShipDate.Date).OrderBy(g => g.Key);
    }
    @if (!grouped.Any())
    {
        <div class="text-center py-5">
            <i class="bi bi-inbox display-1 text-muted mb-3"></i>
            <h4 class="text-muted">No orders found for the selected filters.</h4>
            <p class="text-muted">Try adjusting your filters to view available orders.</p>
        </div>
    }
    else
    {
        @foreach (var group in grouped)
        {
            <!-- Date Group Header -->
            <div class="card shadow-sm border-0 mb-4 overflow-hidden" style="border-radius: 12px;">
                <div class="card-header bg-gradient-primary text-white p-4 border-0" style="background: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%);">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <span class="badge bg-light text-primary me-3 fs-5 px-3 py-2 rounded-pill">
                                <i class="bi bi-calendar-day me-1"></i>@group.Key.ToString("dddd")
                            </span>
                            <span class="badge bg-light text-primary fs-5 px-3 py-2 rounded-pill">
                                <i class="bi bi-receipt me-1"></i>@group.Count() Orders
                            </span>
                        </div>
                        <h3 class="fw-bold mb-0">@group.Key.ToString("MMMM dd, yyyy")</h3>
                    </div>
                </div>
                <!-- Orders Table -->
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle" id="ordersTable_@group.Key.ToString("yyyyMMdd")">
                        <thead class="table-dark">
                            <tr>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-person-badge me-1"></i>Customer Code</th>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-truck me-1"></i>Ship Date</th>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-arrow-right-circle me-1"></i>Trans Code</th>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-boxes me-1"></i>Total Pallet</th>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-grid-3x3-gap me-1"></i>Total Column</th>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-circle-fill me-1"></i>Status</th>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-clock me-1"></i>Plan Delivery</th>
                                <th class="border-0 fw-semibold text-white"><i class="bi bi-clock-history me-1"></i>Actions</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            @foreach (var order in group.OrderBy(o => o.ShipDate))
                            {
                                <tr class="align-middle">
                                    <td class="fw-medium text-primary">@order.CustomerCode</td>
                                    <td>@order.ShipDate.ToString("MMM dd, yyyy")</td>
                                    <td class="text-muted">@order.TransCd</td>
                                    <td class="fw-semibold text-success">@order.TotalPallet</td>
                                    <td class="fw-semibold text-info">@order.TotalColumn</td>
                                    <td>
                                        @{
                                            var status = order.OrderStatus switch
                                            {
                                                0 => "Planned",
                                                1 => "Pending",
                                                2 => "Completed",
                                                3 => "Shipped",
                                                4 => "Delay",
                                                _ => "Unknown"
                                            };
                                            var badgeClass = order.OrderStatus switch
                                            {
                                                0 => "bg-dark text-white",
                                                1 => "bg-primary text-white",
                                                2 => "bg-success text-white",
                                                3 => "bg-warning text-dark",
                                                4 => "bg-danger text-white",
                                                _ => "bg-danger text-white"
                                            };
                                        }
                                        <span class="badge @badgeClass px-2 py-1">@status</span>
                                    </td>
                                    <td class="fw-medium">@order.EndTime.ToString("HH:mm")</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-sm btn-outline-info rounded-pill me-1" onclick="loadDelayHistory('@order.UId')" title="View Delay History">
                                                <i class="bi bi-eye me-1"></i>View History
                                            </button>
                                            <button class="btn btn-sm btn-outline-success rounded-pill" onclick="exportToExcel('@order.UId')" title="Export Picking List to Excel">
                                                <i class="bi bi-file-earmark-excel me-1"></i>Export Excel
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
    }
    <!-- Delay History Modal -->
    <div class="modal fade" id="delayModal" tabindex="-1" aria-labelledby="delayModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-4">
                <div class="modal-header bg-primary text-white border-0 rounded-top-4">
                    <h5 class="modal-title fw-bold mb-0 d-flex align-items-center fs-3" id="delayModalLabel">
                        <i class="bi bi-clock-history me-2"></i>Delay History Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover align-middle fs-3" id="delayTable">
                            <thead class="table-light">
                                <tr>
                                    <th class="fw-semibold fs-4"><i class="bi bi-exclamation-triangle me-1"></i>Delay Type</th>
                                    <th class="fw-semibold fs-4"><i class="bi bi-chat-text me-1"></i>Reason</th>
                                    <th class="fw-semibold fs-4"><i class="bi bi-clock me-1"></i>Start Time</th>
                                    <th class="fw-semibold fs-4"><i class="bi bi-stopwatch me-1"></i>Delay (Hours)</th>
                                </tr>
                            </thead>
                            <tbody class="fs-3"></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer bg-light border-0 rounded-bottom-4 justify-content-center">
                    <button type="button" class="btn btn-secondary px-4 rounded-pill fs-5" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
@section Styles {
    <link href="~/css/OrderList.css" rel="stylesheet" />
    <!-- Optional: Include AOS for animations if not already in layout -->
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
}
@section Scripts {
    <script src="~/js/OrderList.js"></script>
}